---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Donate | Nony">
  <main class="donate-wrapper">
    <div class="content">
      <h1>You have money. I have bugs.</h1>
      <p>Let's solve one of those problems.</p>

      <div class="choice-container">
        <!-- BUTTON A: The Runner -->
        <button class="btn-ghost" id="btn-fix">Fix the Bugs</button>

        <!-- BUTTON B: The Real Deal -->
        <!-- Removed href here, handling in JS for modal -->
        <button class="bmc-button-wrapper" id="btn-donate">
          <img
            src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png"
            alt="Buy Me A Coffee"
            width="217"
            height="60"
          />
        </button>
      </div>
    </div>

    <!-- BUG CONTAINER -->
    <div id="bug-container"></div>

    <!-- SASSY MODAL -->
    <dialog id="donate-modal">
      <div class="modal-content">
        <h2>I saw that.</h2>
        <p>Thanks for enabling my caffeine addiction.</p>
        <form method="dialog">
          <button>You're welcome</button>
        </form>
      </div>
    </dialog>
  </main>
</Layout>

<script>
  // FAKE CHOICE LOGIC
  const btnFix = document.getElementById("btn-fix");

  if (btnFix) {
    btnFix.addEventListener("mouseover", () => {
      const x = Math.random() * (window.innerWidth - 200);
      const y = Math.random() * (window.innerHeight - 100);
      btnFix.style.position = "fixed";
      btnFix.style.left = `${x}px`;
      btnFix.style.top = `${y}px`;
    });

    btnFix.addEventListener("click", () => {
      alert("Error: 404 Motivation Not Found. Try the other button.");
    });
  }

  // DONATE MODAL LOGIC
  const btnDonate = document.getElementById("btn-donate");
  const modal = document.getElementById("donate-modal") as HTMLDialogElement;

  if (btnDonate && modal) {
    btnDonate.addEventListener("click", () => {
      // Open BMC in new tab
      window.open("https://buymeacoffee.com/itsnony", "_blank");
      // Show Modal
      modal.showModal();
    });
  }

  // BUG LOGIC
  const bugContainer = document.getElementById("bug-container");

  function createBug() {
    const bug = document.createElement("div");
    bug.classList.add("bug");

    // Random Position
    bug.style.left = Math.random() * 90 + "vw";
    bug.style.top = Math.random() * 90 + "vh";

    // Random Rotation
    const rotation = Math.random() * 360;
    bug.style.transform = `rotate(${rotation}deg)`;

    // SVG Icon
    bug.innerHTML = `<svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor"><path d="M12 2C9 2 7 3.5 7 5.5V7C7 7 4 7 4 9C4 11 6 11.5 6 12C6 13 4 13.5 4 15C4 17 7 19 7 19V22H9V19H15V22H17V19C17 19 20 17 20 15C20 13.5 18 13 18 12C18 11.5 20 11 20 9C20 7 17 7 17 7V5.5C17 3.5 15 2 12 2M7.5 17C7.5 17 6 16 6 15C6 14.5 7.5 14.5 7.5 14.5L8 12L7.5 9.5C7.5 9.5 6 9.5 6 9C6 8 7.5 7 7.5 7H16.5C16.5 7 18 8 18 9C18 9.5 16.5 9.5 16.5 9.5L16 12L16.5 14.5C16.5 14.5 18 14.5 18 15C18 16 16.5 17 16.5 17H7.5Z"/></svg>`;

    // Crawl Animation
    const duration = 5000 + Math.random() * 5000;
    bug.animate(
      [
        { transform: `rotate(${rotation}deg) translate(0,0)` },
        {
          transform: `rotate(${rotation}deg) translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px)`,
        },
      ],
      {
        duration: duration,
        iterations: Infinity,
        direction: "alternate",
        easing: "ease-in-out",
      },
    );

    // Click to Squish
    // IMPORTANT: z-index must be high to capture clicks
    bug.addEventListener("click", (e) => {
      e.stopPropagation(); // Stop bubbling
      console.log("Squished!");
      squishBug(bug);
    });

    bugContainer.appendChild(bug);
  }

  function squishBug(bug) {
    // Squish Visual
    bug.style.transform = "scale(1.5) rotate(45deg)";
    bug.style.color = "red";
    bug.style.pointerEvents = "none"; // Prevent double squish

    // +1 Text
    const plusOne = document.createElement("div");
    plusOne.innerText = "+1 Error";
    plusOne.classList.add("plus-one");
    plusOne.style.left = bug.style.left;
    plusOne.style.top = bug.style.top;
    bugContainer.appendChild(plusOne);

    // Remove text after anim
    setTimeout(() => plusOne.remove(), 1000);

    // Spawn 2 More
    setTimeout(() => {
      bug.remove();
      createBug();
      createBug();
    }, 500);
  }

  // Start with 1 bug
  setTimeout(createBug, 1000);
</script>

<style>
  .donate-wrapper {
    min-height: 80vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 0 1rem;
    position: relative;
    overflow: hidden; /* Keep bugs inside */
  }

  .content {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    align-items: center;
    max-width: 600px;
    position: relative;
    z-index: 10;
  }

  h1 {
    font-family: "Fira Code", monospace;
    font-size: clamp(2rem, 6vw, 4rem);
    font-weight: 900;
    line-height: 1.1;
    margin: 0;
  }

  p {
    font-family: "Fraunces", serif;
    font-size: clamp(1.2rem, 3vw, 1.5rem);
    opacity: 0.8;
    margin: 0;
    max-width: 400px;
  }

  .choice-container {
    display: flex;
    gap: 2rem;
    align-items: center;
    margin-top: 2rem;
    flex-wrap: wrap;
    justify-content: center;
    min-height: 80px;
  }

  .bmc-button-wrapper {
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  .bmc-button-wrapper:hover {
    transform: scale(1.05) rotate(-2deg);
  }

  .btn-ghost {
    background: rgba(128, 128, 128, 0.1);
    border: 2px solid rgba(128, 128, 128, 0.3);
    color: var(--color-text);
    padding: 1rem 2rem;
    border-radius: 50px;
    font-family: "Fira Code", monospace;
    font-weight: 700;
    cursor: pointer;
    opacity: 0.6;
    transition: all 0.2s;
  }
  .btn-ghost:hover {
    background: rgba(255, 0, 0, 0.1);
    color: red;
    border-color: red;
  }

  /* BUGS */
  :global(.bug) {
    position: absolute;
    color: var(--color-text);
    opacity: 0.8;
    cursor: pointer; /* Explicit pointer */
    transition: transform 0.2s;
    z-index: 50; /* High z-index to be clickable */
    width: 40px; /* Bigger hit area */
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  :global(.plus-one) {
    position: absolute;
    color: red;
    font-family: "Fira Code", monospace;
    font-weight: bold;
    animation: floatUp 1s forwards;
    pointer-events: none;
    z-index: 100;
  }

  @keyframes floatUp {
    from {
      transform: translateY(0);
      opacity: 1;
    }
    to {
      transform: translateY(-30px);
      opacity: 0;
    }
  }

  /* MODAL */
  dialog {
    border: none;
    border-radius: 16px;
    background: var(--color-surface);
    border: 1px solid var(--color-primary);
    padding: 0;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
    color: var(--color-text);
    z-index: 200;
  }
  dialog::backdrop {
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
  }
  .modal-content {
    padding: 2rem;
    text-align: center;
  }
  .modal-content h2 {
    font-family: "Fraunces", serif;
    margin-top: 0;
  }
  .modal-content button {
    background: var(--color-text);
    color: var(--color-bg);
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 50px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 1rem;
  }
</style>
